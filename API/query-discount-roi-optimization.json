{
  "query": "WITH DiscountPerformance AS (SELECT DiscountBand, Product_1 as Product, Segment, AVG(CAST(Discounts as DECIMAL(18,2))) as AvgDiscount, SUM(CAST(GrossSales as DECIMAL(18,2))) as Revenue, SUM(CAST(Profit as DECIMAL(18,2))) as Profit, COUNT(*) as Sales, (SUM(CAST(Profit as DECIMAL(18,2))) / SUM(CAST(GrossSales as DECIMAL(18,2))) * 100) as ROI FROM [Upload_edaa4303640341b48950bb3eb0385f60_20251215203858] WHERE DiscountBand IN ('High', 'Medium', 'Low', 'None') GROUP BY DiscountBand, Product_1, Segment HAVING SUM(CAST(GrossSales as DECIMAL(18,2))) > 100000), RankedDiscounts AS (SELECT *, ROW_NUMBER() OVER (PARTITION BY DiscountBand ORDER BY ROI DESC) as RankByROI FROM DiscountPerformance) SELECT DiscountBand, Product, Segment, CAST(AvgDiscount as DECIMAL(18,2)) as AvgDiscount, CAST(Revenue as DECIMAL(18,2)) as Revenue, CAST(Profit as DECIMAL(18,2)) as Profit, Sales, CAST(ROI as DECIMAL(10,2)) as ROI_Percent, RankByROI FROM RankedDiscounts WHERE RankByROI <= 3 ORDER BY DiscountBand, RankByROI"
}
